# 詳細設計書

## 画面設計（詳細）

- 画面の項目ごとの詳細仕様
  - 入力形式
  - チェック条件
  - データ項目対応
  - ボタン動作
  - など
- 画面のレイアウト図や部品の配置図
- エラーメッセージや入力制御の詳細

## 帳票設計（詳細）

- 帳票レイアウトの詳細
- 印刷位置
- フォント
- 集計ロジック。

## 機能設計（プログラム設計）

- 各機能
    - 機能の処理手順
        - その機能がどのようなステップで動作するかを、順序立てて具体的に記述します。
        - 入力から出力までの流れを明確にすることで、実装者が仕様を誤解せずに開発できるようにします。
    - アルゴリズム
        - 機能を実現するための計算方法や手続きのロジックを説明します。
        - 特に複雑な処理や性能に影響する部分、独自に設計した処理ロジックを明示します。
    - 業務ロジックの詳細
        - 業務ルールやビジネス上の制約・条件を詳細に記述します。
        - どの条件でどの処理を行うのか、例外ケースの取り扱いも含みます。
    - エラー・例外処理
        - エラー例外名
            - 発生条件：
            - 処理内容：
    - フローチャートやシーケンス図、擬似コード。

    - 使用クラス
        - クラス名
        - メソッド名
        - 用途

## クラス設計（機能別または全体）

システム機能を実現するためのクラス構造の設計を記載する。

## 使用デザインパターン

Strategy,Repositoryなどパターンと適用クラス、意図を記載。

### クラス一覧

| クラス名 | 責務（役割） | 関連機能 | 備考 |
|----------|---------------|-----------|------|
| `UserService` | ユーザーの登録・認証処理を提供 | ユーザー登録、ログイン | - |
| `UserRepository` | ユーザー情報の永続化（DB） | ユーザー登録、検索 | DBアクセス層 |
| `User` | ユーザーモデル | - | Entity／ドメインオブジェクト |

### クラス図

- UML
- クラス構造、継承、依存関係、集約関係などを視覚的に表現。
- PlantUML や StarUML、Visioなどで作成可。

### クラス詳細仕様

- クラス名
  - 責務
  - 属性
  - メソッド

※インタフェースを含む

#### sample

``` markdown
##### クラス：UserService

- **責務**：ユーザー関連のビジネスロジックを提供する。
- **属性**：
  - `UserRepository userRepository`：ユーザー情報の参照・保存に使用
- **メソッド**：
  - `registerUser(userName: string, password: string): bool`  
    ユーザー名とパスワードを検証し、DBに登録する。
  - `login(userName: string, password: string): bool`  
    認証処理を行う。パスワード照合。

##### クラス：User

- **責務**：ユーザー情報を保持するエンティティ
- **属性**：
  - `userId: string`
  - `userName: string`
  - `passwordHash: string`
- **メソッド**：
  - `validate(): bool` 入力値の検証を行う
```

※他のクラスも同様に記載

---

## データベース設計（詳細）

- テーブル定義（カラム名、型、制約条件）
- インデックス設計
- トリガー
- ストアドプロシージャ等

## インターフェース設計（詳細）

- API仕様
- 通信プロトコルの詳細
- データフォーマット（XML、JSONなど）
- エラーハンドリング

## 例外処理やエラーハンドリング仕様

- 例外の分類
- 発生条件
- ログ出力方法
- ユーザー通知方式
- など。

## パフォーマンスチューニングやセキュリティ実装の詳細

- ボトルネック回避
- キャッシュ、
- SQL最適化、
- XSS対策
- CSRF対策
- など。

## トレーサビリティ

基本設計書とのトレーサビリティー

- 機能（基本設計）
  - ⇔機能（詳細設計）
  - ⇔クラス
  - ⇔
- その他（基本設計）
  - ⇔
- 以下略

## 備考（項目ではなく）

「システム的な保護・防御」に関する設計内容は、以下のいずれか、または複数の章に明記する

- 例

| 内容                             | 推奨セクション                                  | 理由                               |
| ------------------------------ | ---------------------------------------- | -------------------------------- |
| ファイル破損防止（排他制御・一時ファイル・リネーム方式など） | **例外処理・エラーハンドリング** or **パフォーマンス・セキュリティ** | 処理失敗・障害系の扱いとして記述するのが自然。          |
| キャッシュ未反映の防止（強制リロード、バージョン付与など）  | **インターフェース設計（詳細）**                       | 通信／データの整合性対策であるため。               |
| 排他制御（ファイルロック・スレッドロック）          | **機能設計** or **例外処理／システム制御設計**            | 処理の一部として記述しておくことで、設計者間の認識齟齬を防げる。 |

ENUM,構造体などについては、以下であれば記載する。

- ビジネス的意味を持つデータ型（例：Enumの状態管理、役割区分など）
- システム間インターフェースやAPIの入力・出力データ構造
- 複数フィールドをまとめる構造体やDTO
- 設計者・開発者間の共通理解が必要な重要なデータ形式